\chapter{Discussion}
\label{Discussion}

When the only constraints is the set for the input reference to the pumps, the MPC acts as supposed, where the reference is set to the minimum value for the pumps. However, when more constraints are added, the MPC problem can not be solved as the solution becomes infeasible.  

For the MPC to work in a real world water distribution network, the model will be affected by uncertainties in the prediction e.g. estimations of electricity price and water consumptions. At some point the model will deviate from the actual plant, especially in this case where a small signal model has been derived around a specific operating point. Therefore, the state of the water tower will be affect by these uncertainties e.g. in a situation were the consumption is highly unexpected, the MPC could violate the constraints.

In a situation were prediction error, model deviation and disturbance uncertainty is present, constraints can be violated even though the MPC originally computes otherwise. If the cause is not corrected this could continuing infinitely, thus losing control as no feasible solution can be found. 

A method to avoid this situation is to soften the constraints. Changing constraints from hard to soft can be done by having requirements that must be satisfied changed to be dependent on a variable that will be penalized by the cost function, if the variable is outside a desired range. Thus infeasibility can not occur and the MPC will instead try to bring the solution inside the optimal constraint region due to the penalized variable.\\   
Introducing such a variable is not always possible as some constraints are bound by physical parameters ensuring system safety, but can by applied to other constraints.\\

Another approach could be to include an adaptive control part to the MPC. This could tune the parameters in the controller, such that when deviations in e.g. water consumption, electrical prices or the water tower level are appearing, the adaptive part would adjust the parameters such that the deviations would become smaller.




% The constrained MPC problem implemented on the system is capable of minimizing the running cost of the water distribution test setup. If this was to be used in a real world situation some challenges could arise. A main concern is violation of the constrains, as this could in worst case lead to failure or in less severe cases, an unsatisfying performance. 
% The MPC is minimizing a numerical problem and if the optimal solution is found within the constraints, it is used, thus will the MPC be able to operate until the very boundaries of the stated constraints. 

% In the case of the water distribution system both the forecast of the electrical price and the water consumption will, in a real world scenario, be affected by uncertainty. Additionally will some deviation between the model and plant be present, especially when the model is obtained by linearizing and parameter estimating around a specific operating point. Thus will the state of the WT be affected by these uncertainties and e.g. in a situation were the consumption is highly unexpected, the MPC could violate the constraints. 

% In a situation were prediction error, model deviation and disturbance uncertainty is present, constraints can be violated even though the MPC originally computes otherwise. If the cause is not corrected this could continuing infinitely, thus losing control as no feasible solution can be found.   

% A method to avoid this situation is to soften the constraints. Changing constraints from hard to soft can be done by having requirements that must be satisfied changed to be dependent on a variable that will be penalized by the cost function, if the variable is outside a desired range. Thus infeasibility can not occur and the MPC will instead try to bring the solution inside the optimal constraint region due to the penalized variable.\\   
% Introducing such a variable is not always possible as some constraints are bound by physical parameters ensuring system safety, but can by applied to other constraints. 

