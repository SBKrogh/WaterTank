\chapter{Discussion}
\label{Discussion}

When only constraints for the input to the pumps are present, the MPC acts as supposed, as the reference is set to the minimum value no matter what the price is. However, when the rest of the constraints are added, the optimization fails to find a solution in the feasible region. Changing the upper and lower bounds of the WT and output pressure constraints, the global minimum can be found. When the inequality intervals of the WT and output pressure constraints are modified and used together with the constraints on the input signal, they become inactive and do not take part in the optimization. That is due to the inappropriate and arbitary selection of the upper and lower bounds. 
However, the most suitable argumentation why the constraints do not work can be explained by the reformulation of them. As the minimization is over the control input, the constraints on the output and WT pressure are transformed to the control input. The reformulation is done by using the extended system dynamics in \secref{ObjFunc_reform}. The system matrices for the control horizon take part directly in the inequality constraints when the transformation is done e.g. from $\bm{y_{Hp}}$ to $\bm{u_{Hp}}$. Infeasibility can be caused by the trivial equation introduced in the first row of the extended matrix. The trivial entry of the matrix is introduced in order to match the indexing in the objective function. By using this matrix in the reformulated constraints, the first row zeros out the first optimal solution of $\bm{u_{Hp}}$, therefore no matter what the optimal control value is, the lower bound of the small-signal constraint must be lower than zero and the upper bound must be positive. If it does not apply for the first entry of $\bm{u_{Hp}}$, then the constraint can result in infeasibility. 

For the MPC to work in a real world water distribution network, the model will be affected by uncertainties in the prediction e.g. estimations of electricity price and water consumptions. At some point the model will deviate from the actual plant, especially in this case where a small signal model has been derived around a specific operating point. Therefore, the state of the WT will be affect by these uncertainties e.g. in a situation were the consumption is highly unexpected, the MPC could violate the constraints.

In a situation were prediction error, model deviation and disturbance uncertainty is present, constraints can be violated even though the MPC originally computes otherwise. If the cause is not corrected this could continuing infinitely, thus losing control as no feasible solution can be found. 

A method to avoid this situation is to soften the constraints. Changing constraints from hard to soft can be done by having requirements that must be satisfied changed to be dependent on a variable that will be penalized by the cost function, if the variable is outside a desired range. Thus infeasibility can not occur and the MPC will instead try to bring the solution inside the optimal constraint region due to the penalized variable.\\   
Introducing such a variable is not always possible as some constraints are bound by physical parameters ensuring system safety, but can by applied to other constraints.\\

Another approach could be to include an adaptive control part to the MPC. This could tune the parameters in the controller, such that when deviations in e.g. water consumption, electrical prices or the WT level are appearing, the adaptive part would adjust the parameters such that the deviations would become smaller.




% The constrained MPC problem implemented on the system is capable of minimizing the running cost of the water distribution test setup. If this was to be used in a real world situation some challenges could arise. A main concern is violation of the constrains, as this could in worst case lead to failure or in less severe cases, an unsatisfying performance. 
% The MPC is minimizing a numerical problem and if the optimal solution is found within the constraints, it is used, thus will the MPC be able to operate until the very boundaries of the stated constraints. 

% In the case of the water distribution system both the forecast of the electrical price and the water consumption will, in a real world scenario, be affected by uncertainty. Additionally will some deviation between the model and plant be present, especially when the model is obtained by linearizing and parameter estimating around a specific operating point. Thus will the state of the WT be affected by these uncertainties and e.g. in a situation were the consumption is highly unexpected, the MPC could violate the constraints. 

% In a situation were prediction error, model deviation and disturbance uncertainty is present, constraints can be violated even though the MPC originally computes otherwise. If the cause is not corrected this could continuing infinitely, thus losing control as no feasible solution can be found.   

% A method to avoid this situation is to soften the constraints. Changing constraints from hard to soft can be done by having requirements that must be satisfied changed to be dependent on a variable that will be penalized by the cost function, if the variable is outside a desired range. Thus infeasibility can not occur and the MPC will instead try to bring the solution inside the optimal constraint region due to the penalized variable.\\   
% Introducing such a variable is not always possible as some constraints are bound by physical parameters ensuring system safety, but can by applied to other constraints. 

