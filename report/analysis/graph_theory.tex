\section{Graph Representation}  
\label{GraphTheory}
A graph is a formal mathematical way for representing a network which can be applicable, among others, 
in engineering or scientistific research, mechanical systems, electrical circuits or hydraulic networks \cite{graph_intro}. 

In order to make the modelling of the water distribution network, Graph Theory is used. A graph, G, is constructed based on the affinity between electrical and hydraulic networks. 
Each terminal of the network is associated with a node, and the components of the system correspond to edges \cite{GraphTheoryCarsten}. 
\subsection{Incidence Matrix} 

The incidence matrix, H, of a graph with \textit{n} nodes and \textit{e} edges is 
defined by $H = [a_{ij}]$. Where the number of rows and columns are defined by the amount of nodes, i, and edges, j, respectively.
In case of hydraulic networks, edges have a direction which results in a directed incidence matrix:

\begin{equation}
\label{DiGraph}
 a_{ij} =
		\left\{
		\begin{array}{ll}
		
		1 			&      \text{if the edges is incidence out of the node}	
\\
		-1                       &     \text{if the edges is incidence into the node}
\\

                0                       &      \text{otherwise}

		\end{array}
		\right.
\end{equation}	

In \appref{IncidenceSection} the corresponding incidence matrix of the system is 
shown. 

\subsection{Cycle Matrix}
\label{CycleSection}
A spanning tree, $T \in G$ is a subgraph which contains all nodes of G but has no cycles \cite{GraphModel}. 
In order to obtain the spanning tree it is necessary to delete an edge from each circuit of the graph. The removed edges are called chords. To obtain the number 
of chords, \textit{l}, the following applies:

\begin{equation}
  \label{Numberofchords}
  l = e - n +1
\end{equation}

Adding any one chord to T, it is created one circuit which is called fundamental circuit. A graph is conformed by as many fundamental circuits as number of chords it has \cite{GraphModel}.  
This set of fundamental circuits correspond to the fundamental circuit matrix 
$B_f$, such as the number of rows and columns are defined by the amount of chords and edges, respectively. 

Similarly to the incidence matrix, the edges conforming the fundamental circuit 
matrix have a direction associated with them. Then, the B matrix can be 
expressed with $B = [b_{ij}]$ and

\begin{equation}
\label{DiGraphCycle}
 b_{ij} =
		\left\{
		\begin{array}{ll}
		
		1 			&      \text{if the edges is in the circuit i and the directions match}	
\\
		-1                       &     \text{if the edges is in the circuit i and the directions are opposite}
\\

                0                       &      \text{otherwise}

		\end{array}
		\right.
\end{equation}	

In \appref{CycleAppendix} the corresponding incidence matrix of the system is 
shown.

\subsection{Kirchhoff's Law}
\label{KirchhoffSection}

The directed graph of a hydraulic network has assigned to its edges two variables: 
the pressure, $p_k(t)$, and the flow, $q_k(t)$. These two variables are vectors containing the individual flows through the edges and 
the voltage across the edges, where:


\begin{minipage}{0.45\linewidth}
\begin{equation}
p(t) =
\begin{bmatrix}
         p_1 \\
	p_2 \\ 
	\vdots \\
	p_e \\
\end{bmatrix}  \nonumber
\end{equation}  
\end{minipage}

\begin{minipage}{0.45\linewidth}
 \begin{equation}
q(t) =
\begin{bmatrix}
         q_1 \\
	q_2 \\ 
	\vdots \\
	q_e \\
\end{bmatrix}
\end{equation}
\end{minipage}
 
In order to derive a model of the hydraulic network a set of independent flow variables has to be identified \cite{TowerModel}. These flow variables have the characteristic 
that their values can be set independently from other flows in the network, and coincide with the flows through the chords. 
Therefore, it has been decided to choose the numbering of the columns of the 
H and B matrix, such as:

\begin{minipage}{0.45\textwidth}
\begin{equation}
H = [H_c \quad H_f]
\end{equation}   \nonumber
\end{minipage}

\begin{minipage}{0.45\textwidth}
\begin{equation}
B = [B_c  \quad B_f]
\end{equation}
\end{minipage}

\begin{minipage}[t]{0.20\textwidth}
Where\\
\hspace*{8mm} $H_c \quad \text{and} \quad B_c$ \\
\hspace*{8mm} $H_f \quad \text{and} \quad B_f$ 
\end{minipage}
\begin{minipage}[t]{0.68\textwidth}
\vspace*{2mm}
\hspace*{8mm} are the matrix corresponding to the chords\\
\hspace*{8mm} are the matrix corresponding to the spanning tree 
\end{minipage}

Since the edges variables are elements interconnected to form a network, 
they must obey Kirchhoff´s node and loops law \cite{GraphModel}. 

Kirchhoff´s Current Law (KCL) states that the net sum of all the currents 
leaving the node is zero. Formulating this statement in matrix form:

\begin{equation}
  Hq(t) = 0
\end{equation}

Furthermore, regarding Kirchhoff´s Voltage Law (KVL) it is stated that at any time the net sum of the voltage around a cycle 
is zero. In terms of matrix form:

\begin{equation}
  B\Delta p (t) = 0
\end{equation}

Where the fundamental loops have a reference direction given by the direction of the 
chords. 





 