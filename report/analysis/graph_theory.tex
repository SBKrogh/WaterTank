\section{Graph Representation}  
\label{GraphTheory}
A graph is a formal mathematical way for representing a network which can be applicable, among others, 
in engineering or scientific research, mechanical systems, electrical circuits or hydraulic networks \cite{graph_intro}. 

In order to make the modelling of the water distribution network, Graph Theory is used. 
Each terminal of the network is associated with a node, and the components of the system correspond to edges \cite{GraphTheoryCarsten}. 
\subsection{Incidence Matrix} 
\label{IncidenceSection}
The incidence matrix, $H$, of a graph with \textit{n} nodes and \textit{e} edges is 
defined by $H = [a_{ij}]$. Where the number of rows and columns are defined by the amount of nodes and edges respectively. 
Additionally, the particular node and edge is denoted with the indices $i$ and 
$j$, respectively.

In case of hydraulic networks, edges have a direction which results in a directed incidence matrix:

\begin{equation}
\label{DiGraph}
 a_{ij} =
		\left\{
		\begin{array}{ll}
		
		1 			&      \text{if the $j_{th}$ edge is incident out of the $i_{th}$ node}	
\\
		-1                       &     \text{if the $j_{th}$ edge is incident into the $i_{th}$ node}
\\


                0                       &      \text{otherwise}

		\end{array}
		\right.
\end{equation}	

In \appref{IncidenceSection} the corresponding incidence matrix of the system is 
shown. 

\subsection{Cycle Matrix}
\label{CycleSection}
A spanning tree, $T \in G$ is a subgraph which contains all nodes of $G$ but has no cycles \cite{GraphModel}. 
In order to obtain the spanning tree it is necessary to delete an edge from each cycle of the graph. The removed edges are called chords. To obtain the number 
of chords, \textit{l}, the following applies:

\begin{equation}
  \label{Numberofchords}
  l = e - n +1
\end{equation}

Adding any one chord to $T$, creates one cycle which is called fundamental cycle. A graph is conformed by as many fundamental cycles as number of chords it has \cite{GraphModel}.  
This set of fundamental cycle correspond to the fundamental cycle matrix 
$B$, such as the number of rows and columns are defined by the amount of chords and edges, respectively. 

Then, the cycle matrix of a directed graph can be 
expressed with $B = [b_{ij}]$ where $i$ and $j$ denote the particular chord and 
edge, respectively. 

\begin{equation}
\label{DiGraphCycle}
 b_{ij} =
		\left\{
		\begin{array}{ll}
		
		1 			&      \text{if the edges $j_{th}$ is in the cycle $i_{th}$ and the directions match}	
\\
		-1                       &     \text{if the edges $j_{th}$ is in the cycle $i_{th}$ and the directions are opposite}
\\

                0                       &      \text{otherwise}

		\end{array}
		\right.
\end{equation}	

In \appref{CycleAppendix} the corresponding incidence matrix of the system is 
shown.

\subsection{Kirchhoff's Law}
\label{KirchhoffSection}

The directed graph of a hydraulic network assigns two variables to each edges: 
the pressure, $p_k(t)$, and the flow, $q_k(t)$. These two variables are vectors containing the individual flows through the edges and 
the pressure across them, where:


% \begin{minipage}{0.45\linewidth}
% \begin{equation}
% p(t) =
% \begin{bmatrix}
%          p_1 \\
% 	p_2 \\ 
% 	\vdots \\
% 	p_e \\
% \end{bmatrix}  \nonumber
% \end{equation}  
% \end{minipage}

% \begin{minipage}{0.45\linewidth}
%  \begin{equation}
% q(t) =
% \begin{bmatrix}
%          q_1 \\
% 	q_2 \\ 
% 	\vdots \\
% 	q_e \\
% \end{bmatrix}
% \end{equation}
% \end{minipage}

\begin{equation}
%\[
p(t) =
\begin{bmatrix}
         p_1 \\
	p_2 \\ 
	\vdots \\
	p_e \\
\end{bmatrix}
\text{and}\hspace{0.3cm}
q(t) =
\begin{bmatrix}
         q_1 \\
	q_2 \\ 
	\vdots \\
	q_e \\
\end{bmatrix}
%\]
\end{equation}
 
In order to derive a model of the hydraulic network a set of independent flow variables has to be identified \cite{TowerModel}. These variables have the characteristics 
that their values can be set independently from other flows in the network, and coincide with the flows through the chords. 
Therefore, it has been decided to choose the numbering of the columns of the 
H and B matrix, such as:

% \begin{minipage}{0.45\textwidth}
% \begin{equation}
% H = [H_c \quad H_f]
% \end{equation}   \nonumber
% \end{minipage}

% \begin{minipage}{0.45\textwidth}
% \begin{equation}
% B = [B_c  \quad B_f]
% \end{equation}
% \end{minipage}

\begin{equation}
%\[
H = [H_c \quad H_f]
\hspace{0.1cm} \text{and}\hspace{0.3cm}
B = [B_c  \quad B_f]
%\]
\end{equation}

\begin{minipage}[t]{0.20\textwidth}
Where\\
\hspace*{8mm} $H_c \quad \text{and} \quad B_c$ \\
\hspace*{8mm} $H_f \quad \text{and} \quad B_f$ 
\end{minipage}
\begin{minipage}[t]{0.68\textwidth}
\vspace*{2mm}
\hspace*{8mm} are the matrix corresponding to the chords\\
\hspace*{8mm} are the matrix corresponding to the spanning tree 
\end{minipage}

Since the edge variables are elements interconnected to form a network, 
they must obey Kirchhoff´s node and loops law \cite{GraphModel}. 

Kirchhoff´s Current Law (KCL) states that the net sum of all the flows 
to or from a node is zero. Formulating this statement in matrix form:

\begin{equation}
  \label{KCL}
  Hq(t) = 0
\end{equation}

Furthermore, regarding Kirchhoff´s Voltage Law (KVL) it is stated that at any time the net sum of the pressure around a cycle 
is zero. In terms of matrix form:

\begin{equation}
 \label{KVL} 
 B\Delta p (t) = 0
\end{equation}

Where the fundamental loops have a reference direction given by the direction of the 
chords. 





 