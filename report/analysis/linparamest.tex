\section{Linear parameter estimation} 
\label{LinParamEst}

%As can be seen in \eqref{multistate model_smallsignal}, the small signal model of such a multi-state/ multi-input system consists of two Jacobian matrices, one for the states and one for the inputs to the system. It should be emphasized however that these matrices have to be evaluated at the operating points, at $(\bar{x}, \bar{u})$. It is a reasonable statement since the inputs to the model are the small signal values of OD and differential pressures, dp, from the pumps. Therefore the same excitation to the real test setup can be carried out by taking the operating values into account and by adding them to the small signal values. 

The method that describes the linear parameter estimation is shown in \figref{fig:parame_block_lin} below:

\begin{figure}[H]
\centering
\input{report/tikz/param_block_lin.tex} 
\caption{Parameter identification block diagram for the linear system. }
\label{fig:parame_block_lin}
\end{figure}

In this case small-signal inputs are applied to both the test setup and the model.  Now the linearized model is compared to the real system, therefore the operating point is taken into account. Since the linear model is only valid for small deviations around the operating point, the real system has to be excited around the same operating point to obtain identical behavior. In order to achieve it, the operating values are added to both the input and the output such as: 

\begin{equation}
u_{sys} = \bar{u} + \hat{u}
 \label{u_smallsignal}
\end{equation}

\begin{minipage}[t]{0.20\textwidth}
Where\\
\hspace*{8mm} $\hat{u}$ \\
\hspace*{8mm} $\bar{u}$ \\
\hspace*{8mm} $u_{sys}$ 
\end{minipage}
\begin{minipage}[t]{0.68\textwidth}
\vspace*{2mm}
is the small-signal input, \\
is the operating value of the input,\\
is the input to the real-life system. 
\end{minipage}
\begin{minipage}[t]{0.10\textwidth}
\vspace*{2mm}
\textcolor{White}{te}$\unit{bar}$
\textcolor{White}{te}$\unit{bar}$
\textcolor{White}{te}$\unit{bar}$
\end{minipage} 

\begin{equation}
  y_{sys} = \bar{y} - \hat{y}_{sys} 
 \label{u_smallsignal}
\end{equation}

\begin{minipage}[t]{0.20\textwidth}
Where\\
\hspace*{8mm} $\hat{y}_{sys}$ \\
\hspace*{8mm} $\bar{u}_{sys}$ \\
\hspace*{8mm} $y_{sys}$ 
\end{minipage}
\begin{minipage}[t]{0.68\textwidth}
\vspace*{2mm}
is the small-signal output from the real-life system, \\
is the operating value of the output,\\
is the output from the real-life system. 
\end{minipage}
\begin{minipage}[t]{0.10\textwidth}
\vspace*{2mm}
\textcolor{White}{te}$\unit{bar}$
\textcolor{White}{te}$\unit{bar}$
\textcolor{White}{te}$\unit{bar}$
\end{minipage} 

During the linear parameter estimation, the same problem is solved as it is shown in \eqref{ObjectiveFunction}. In this case, however, the parameters are varied according to the comparison of the small-signal outputs.  

\subsection{Measurements on the test setup}
\label{LinParamEst_measurements}

In order to verify the state-space model derived in \chapref{LinParamEst} with the physical setup, an estimation for the parameters defined in \secref{estimateParameters}
is carried out.

From the system setup $9$ different relative pressures can be measured, following \figref{systemdiagram} notation the sensors are placed in: 
$n_2$ $n_4$ $n_5$ $n_7$ $n_{10}$ $n_{11}$ $n_{15}$ $n_{16}$ $n_{18}$. However, in the control problem of this project only the four PMA relative pressure 
sensor across the end-users and the pressure in the WT will take part. Thus, the estimation will be only focus on obtaining the best fit for those 
sensor outputs relevant in the control part. 

The measurements obtained from the pressure sensors placed in these nodes, are relative to the atmospheric pressure. In order to compare the measurements
from the system setup and the data obtained from the simulation in Matlab, an atmospheric pressure node, $n_1$, is set as reference point.

The relationship between pressures, where DpCXX describes the pressure difference for the XX component, can be defined as:

\text{\underline{Node 10}}
\vspace{4mm}
\begin {equation}
     y_5 = DpC20 + DpC21  
\end{equation}

\text{\underline{Node 11}}
\vspace{4mm}
\begin {equation}
     y_6 = DpC24
\end{equation}


\text{\underline{Node 15}}
\vspace{4mm}
\begin {equation}
     y_7 = DpC28 + DpC20 
\end{equation}

\text{\underline{Node 15}}
\vspace{4mm}
\begin {equation}
     y_8 = DpC31 
\end{equation}

There is no need to define a relation with a referent point for the WT node, since the pressure across the WT is the state of the state-space model. 

\subsection{Estimation Data}

As the parameter estimation is based on a linearized model an operating point for the system is chosen. This point is based on the tank level being approximately half way full which allows for an equal amount of deviation in both directions. For the chosen operating point, data is gather from the system while small steps are individually applied to the two main pumps and the opening degree of the PMA valves. In order to use the data for parameter estimation the operating point is subtracted, leaving only small signal values.  

The operating point of the PMA valves is chosen to $63^{\circ}$ and the small signal values for the estimation can be seen in \figref{fig:est_OD_data}.

\begin{figure}[H]
\centering
\input{report/tikz/est_OD_data.tex} 
\caption{Small signal values of the opening degrees of the pma valves. }
\label{fig:est_OD_data}
\end{figure}

Furthermore the operating point for the pumps is chosen at a speed of $\omega = 0.4$, where the small signal values for the estimation are shown in \figref{fig:est_deltap_data}. 

\begin{figure}[H]
\centering
\input{report/tikz/est_deltap_data.tex} 
\caption{Small signal values of the angular velocity of the two main pumps.}
\label{fig:est_deltap_data}
\end{figure}

Here the plots from Matlab could be inserted with the input signals, output pressures. The process of the data could be explained, where are the measurements...

\todo{Daniel, you have the things for this!}