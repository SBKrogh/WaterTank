\section{Model predictive control}

Model predictive control (MPC) is an advance control method that depends on a dynamic model of the plant. MPC allows to calculate an optimal control signal taking the future electrical pricing into account. In this section the objective function, describing the electrical price, will be setup. Furthermore the MPC will be designed. 

\input{report/design/cost_fkt}

\subsection{Constraints}

When designing a MPC the constraints have to be setup so they represent actuator slew rates, actuator ranges and constraints for the control variables. These constraints are setup as matrices called $\pmb{E}, \pmb{F} \text{and} \:\pmb{G}$. The constraints matrices are given by: 

\begin{equation}
\pmb{E} \cdot [\Delta\tilde u(k|k),...,\Delta\tilde u(k+H_u-1|k),1]^T \leq 0 
\label{eq:slewrate}
\end{equation}
\begin{equation}
\pmb{F} \cdot [\tilde u(k|k),...,\tilde u(k+H_u-1|k),1]^T \leq 0 
\label{eq:actranges}
\end{equation}
\begin{equation}
\pmb{G} \cdot [\tilde y(k+H_w|k),...,\tilde y(k+H_p|k),1]^T \leq 0
\label{eq:controlvar}
\end{equation}


 \begin{minipage}[t]{0.20\textwidth}
 Where\\
 \hspace*{8mm} $\tilde u(k|k)$ \\
 \hspace*{8mm} $\Delta\tilde u(k|k)$ \\
 \hspace*{8mm} $H_u$ \\
 \hspace*{8mm} $H_w$ \\
 and \hspace*{0.7mm} $\tilde y(k+H_w|k)$	
 \end{minipage}
 \begin{minipage}[t]{0.68\textwidth}
 \vspace*{2mm}
 is the input vector, \\
 is the change of the input vector, \\
 is the control horizon, \\
 is the window horizon, \\
 is the estimate of the controlled output to the time $k+H_w$ compared to current output.
 \end{minipage}

The actuator slew rate constrain, matrix $\pmb{E}$, determents how fast the actuator can change per time unit. From this the physical limit of the pumps can be described. The actuator ranges describe how the control signal to the pumps should look. This is simply a way to describe 0 to 100 \% performance. In the case of this project the pumps can be controlled with an input from 0 to 5. The constraints on the control variables is the constraints setup in \secref{control_problem}. \todo{This part could properly be specified better.}

%To easy notation $U(k) = $

%As it can be seen from \eqref{eq:slewrate,eq:actranges,eq:controlvar} depend on three different variables $\hat u(k|k), \Delta\hat u(k|k) \text{and} \hat z(k+H_w|k)$

To calculate the constraint matrices $H_p, H_u \text{and} \: H_w$ need to be determent. In \secref{sec:cost_fkt} the electrical price is descried. From this it can be seen that the price fluctuate a lot but some periodicity can be seen every 24 hours. Therefor both $H_p$ and $ H_u $ is set to 24. 

\todoque{How sould we chose $H_w$}

% The plan from here on is: 

% 1: Describe the transformation of the constraints so they all depend on delta U(k) 

% 2: Explain how the minimization problem can be set up in general and then s.t. the new constrains 

% 3: Cover why we need an observer and what it means for how the minmization problem is set up - U(k) -> \hat U(k|k)
