\section{Convexity}
\label{convexity}
In the following section convexity of the objective function is examined. 
Due to the reformulation of the objective function and constraints, the MPC optimization problem becomes the following: 

\begin{align}
\underset{\bm{\hat{u}_{Hp}}}{min} \:  \Upsilon(\cdot) &= \underset{\bm{\hat{u}_{Hp}}}{min} \:  \frac{1}{\eta}\bigg( \frac{1}{2} \bm{\hat{u}}_{\bm{Hp}}^{T} \bm{R} \bm{\hat{u}}_{\bm{Hp}} + \bm{b} \bm{\hat{u}}_{\bm{Hp}} + c \bigg)\\
\label{eq:obj_final1}
%
s.t. \:\:\:\:\:	&\begin{bmatrix}
		\bm{I} 	\\
		-\bm{I} 	\\
		\bm{L_{y}}	\\
		-\bm{L_{y}}	\\
		\bm{\Gamma}	\\
		-\bm{\Gamma}
	\end{bmatrix}
	\begin{matrix}
			\bm{\hat{u}_{Hp}}
	\end{matrix}
	\geq 
	\begin{bmatrix}
			\bm{\hat{u}_{1}}	\\
			\bm{\hat{u}_{2}}	\\
			\bm{\hat{y}_{1}}	\\
			\bm{\hat{y}_{2}}	\\
			\bm{\Delta \hat{p}_{wt,1}}	\\
			\bm{\Delta \hat{p}_{wt,2}}	
	\end{bmatrix}
\end{align}

As seen is the objective function and the constraints all written up according to the small-signal value of the control signal. 

The definition of a convex function can be written as, $\triangledown(\triangledown g(\cdot)) \geq 0$,  and the definition of a strictly convex function as $\triangledown(\triangledown g(\cdot)) > 0$. For the purpose of this project is it only required for the optimization problem to be convex. 


\begin{figure}[H]
  \centering
  \begin{minipage}[b]{0.45\textwidth}
    \input{report/tikz/convex.tex} 
    \caption{Quadratic convex surface.}
  \end{minipage}
  \hfill
  \begin{minipage}[b]{0.45\textwidth}
    \input{report/tikz/non_convex.tex} 
    \caption{Quadratic non-convex surface}
  \end{minipage}
  \label{fig:nonlinearpumps}
\end{figure}

\subsection{Objective function}
To ensure convexity, the objective function must have a positive semidefinite Hessian. Therefore, the second order derivative of \eqref{eq:obj_final1} is derived bellow: 
%
%\begin{align}
%\underset{\bm{\hat{u}_{Hp}}}{min} \:  \Upsilon(\cdot) &= \underset{\bm{\hat{u}_{Hp}}}{min} \:  \frac{1}{\eta}\bigg( \frac{1}{2} \bm{\hat{u}}_{\bm{Hp}}^{T} \bm{R} \bm{\hat{u}}_{\bm{Hp}} + \bm{b} \bm{\hat{u}}_{\bm{Hp}} + c \bigg)\\
%
%\Upsilon(\cdot) &= \frac{1}{\eta}\bigg( \frac{1}{2} \bm{\hat{u}}_{\bm{Hp}}^{T} \bm{R} \bm{\hat{u}}_{\bm{Hp}} + \bm{b} \bm{\hat{u}}_{\bm{Hp}} + c \bigg)\\
%
%\triangledown \Upsilon(\cdot) &= \frac{1}{\eta}\cdot \big(\bm{R} \bm{\hat{u}}_{\bm{Hp}} + \bm{b} \big)\\
%
%\triangledown(\triangledown \Upsilon(\cdot)) &= \frac{1}{\eta}\cdot \bm{R} 
%
%\end{align}


\begin{align}
\underset{\bm{\hat{u}_{Hp}}}{min} \:  \Upsilon(\cdot) &= \underset{\bm{\hat{u}_{Hp}}}{min} \:  \frac{1}{\eta}\bigg( \frac{1}{2} \bm{\hat{u}}_{\bm{Hp}}^{T} \bm{R} \bm{\hat{u}}_{\bm{Hp}} + \bm{b} \bm{\hat{u}}_{\bm{Hp}} + c \bigg)\\
%
\Upsilon(\cdot) &= \frac{1}{\eta}\bigg( \frac{1}{2} \bm{\hat{u}}_{\bm{Hp}}^{T} \bm{R} \bm{\hat{u}}_{\bm{Hp}} + \bm{b} \bm{\hat{u}}_{\bm{Hp}} + c \bigg)\\
%
\frac{\partial \Upsilon(\cdot)}{\partial \bm{\hat{u}}_{\bm{Hp}}} &= \frac{1}{\eta}\cdot \big(\bm{R} \bm{\hat{u}}_{\bm{Hp}} + \bm{b} \big)\\
%
\frac{\partial^2 \Upsilon(\cdot)}{\partial \bm{\hat{u}}_{\bm{Hp}}} &= \frac{1}{\eta}\cdot \bm{R} 
%
\end{align}

The efficiency, $\eta$, is a positive constant and therefore convexity only depends on $\bm{R}$. $\bm{R}$ depends on $\bm{\Lambda_1}$ from \eqref{pumpflows_simplified}, which is defined as $\bm{\Lambda_1} = -\bm{G_{2}} \bm{B_{1}^T}\bm{M_c^{-1}}\bm{N_c}$. Every term in this expression is know and semi positive definite, except $\bm{M_c}$, which is an outcome of the parameter estimation. Therefore $\bm{M_c}$ must be positive definite to ensure that the objective function is convex, this requirement has been explained in detail in the formulation of \eqref{statespace_control_sys_state}.

\subsection{Constraints}

The convexity of the constraints is investigated with the same procedure as the used for the objective function. All constraints are linear and the Hessian of a linear function, $Ax+b$, is always zero. Therefore the constraints will always be convex.

%In this section:
%\\
%-show how the quadratic problem can be solved
%-prove positive semi-definiteness
